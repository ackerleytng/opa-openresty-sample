package authz

test_lowercase {
	token_type_is_bearer with token as {"type": "bearer"}
}

test_title_case {
	token_type_is_bearer with token as {"type": "Bearer"}
}

test_null {
	not token_type_is_bearer with token as {"type": null}
}

test_undefined {
	not token_type_is_bearer with token as {}
}

test_some_other {
	not token_type_is_bearer with token as {"type": "wrong"}
}

test_parse_from_header {
	token_type_is_bearer with input as {"headers": {"authorization": "Bearer eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiZ1ZTekpnSGgxZG5WYWdaTk43NHc3WHQtX2dsbWRWOE1FZUhwOGVLSWdJIn0.eyJleHAiOjE1OTEzMzQxNjAsImlhdCI6MTU5MTMzMzg2MCwianRpIjoiZWNmOTA2NzMtZWE0Zi00NGYzLWIwMGYtZmJhNzQzZDJmMzlmIiwiaXNzIjoiaHR0cDovL2tleWNsb2FrLmxvY2FsaG9zdC9hdXRoL3JlYWxtcy9hcHBsaWNhdGlvbnMiLCJhdWQiOiJ3aG9hbWkiLCJzdWIiOiJlOWQ0NGI0ZS03ODY0LTQxZjEtOWM4NS1kZjU2NjM2ZTlmOTMiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJ3aG9hbWkiLCJzZXNzaW9uX3N0YXRlIjoiMDAzNGZlNDktYjQwMS00NDZkLThhOGEtN2M3ZWY5ZWM1MTBhIiwiYWNyIjoiMSIsInNjb3BlIjoicHJvZmlsZSB3aG9hbWkgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJVc2VyIFplcm8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ1c2VyMCIsImdpdmVuX25hbWUiOiJVc2VyIiwiZmFtaWx5X25hbWUiOiJaZXJvIiwiZW1haWwiOiJ1c2VyMEBtYWlsLmNvbSJ9.uIwasavUe1AkLYF6AS_nvVROkV3aIZGT260vHLmNZEPfxW8BorrmLoB4BmgzgOtO2v9sCL1IvulMLiTaWAaZQSr5MmU893koiCll3Q6wfeHkjHI2prBFq1SLpSLuQxog7eZV-80TOzDeQkGp-tC9mS_gN2QAbpCF9nTTl32b30gojLhFW9M21lMheVvnw8jrk2YrX1cCWAiAkAqDv5xPlhGKLhNF8ZqHY5XkNKxEtlEtBLu93K0VfdM-muDz6R1HzzPCOVlYSYmkcGIExM8h4uo859SB8_lHb3w5A-ugNAm6NfOfYC1hU2yDJKQJFVzQ0MXhayZ1YYpNmiWAeKdZqA"}}
		 with token_constraints as {
			"cert": "{\"keys\":[{\"kid\":\"bgVSzJgHh1dnVagZNN74w7Xt-_glmdV8MEeHp8eKIgI\",\"kty\":\"RSA\",\"alg\":\"RS256\",\"use\":\"sig\",\"n\":\"7V1dWdxq_dYItuS3ee-n2QQdqiMTplUBVBs-GgU8GRGk-nxAbAH82y6GVHgoh8VSMG2gjQpvztpjdds5gv2cMENyQ8r73aMXTb40YhyrQT4-LX08pK6w3DKtJDa4SCiDzsnglg93wZ5fzUyI8XYfb_eWK19Nmz_26azDCbstkZ_KK5eerVCGho3AnYEaBlJj9GE8btKaCkMOGBEBLRWMm5znYJjdtm1GBklvDzZFeaYMON-qmpImLvbZbYiOCGObfEty1cZm61oIeBXU-fWgQ06dVfEs-CVDSil4KZKGqxct5rvpxsYmcg5KVcEQrpJQ7rJRB33K1cM_eUaJtUY3lQ\",\"e\":\"AQAB\",\"x5c\":[\"MIICpzCCAY8CBgFygqy1pjANBgkqhkiG9w0BAQsFADAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwHhcNMjAwNjA1MDQwOTE2WhcNMzAwNjA1MDQxMDU2WjAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDtXV1Z3Gr91gi25Ld576fZBB2qIxOmVQFUGz4aBTwZEaT6fEBsAfzbLoZUeCiHxVIwbaCNCm/O2mN12zmC/ZwwQ3JDyvvdoxdNvjRiHKtBPj4tfTykrrDcMq0kNrhIKIPOyeCWD3fBnl/NTIjxdh9v95YrX02bP/bprMMJuy2Rn8orl56tUIaGjcCdgRoGUmP0YTxu0poKQw4YEQEtFYybnOdgmN22bUYGSW8PNkV5pgw436qakiYu9tltiI4IY5t8S3LVxmbrWgh4FdT59aBDTp1V8Sz4JUNKKXgpkoarFy3mu+nGxiZyDkpVwRCuklDuslEHfcrVwz95Rom1RjeVAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAF3C8WE7X2EJ8yGZQ2INkrsuzXcnfiJ5fMdFXMu+5+2KI0b5SrnbpCr0MLcOQZqVJYRgkYOMZNCELtfwBpeZHX4id0DqyZ6KekCMpKB0ScTtpsABvcjRTj6qwT36KVhUPLiHHQ81kW4R/zz4cb4w+T+cFyya2Nxuftf6XPoeP2z4AO0zdOTaGRsT5+e/p5kZb48iKdhFJETJdTo+YAmmttQLjEB4BuxJU9aPgq0sz0C7iA/O5uNZmJyLRZCcfalzdPLye7NddWZhjHoZOzd+Lt6HOmIhMdn4dKESpjM2Fkr6LEEhJW06WsolOP/4KsEGUEQZYHsV2k+V7hXXqD9BJlA=\"],\"x5t\":\"F3JK4iyZqPxx3etycjuP-OTRLMg\",\"x5t#S256\":\"_tmQ0nQ0e_fWD-tJOMhu7YxObRDjTfiKgiIR-nXh8fw\"}]}",
			"iss": "http://keycloak.localhost/auth/realms/applications",
			"time": 0,
			"aud": "whoami",
		}
}

test_parse_from_header_w_many_spaces {
	token_type_is_bearer with input as {"headers": {"authorization": "Bearer                 eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiZ1ZTekpnSGgxZG5WYWdaTk43NHc3WHQtX2dsbWRWOE1FZUhwOGVLSWdJIn0.eyJleHAiOjE1OTEzMzQxNjAsImlhdCI6MTU5MTMzMzg2MCwianRpIjoiZWNmOTA2NzMtZWE0Zi00NGYzLWIwMGYtZmJhNzQzZDJmMzlmIiwiaXNzIjoiaHR0cDovL2tleWNsb2FrLmxvY2FsaG9zdC9hdXRoL3JlYWxtcy9hcHBsaWNhdGlvbnMiLCJhdWQiOiJ3aG9hbWkiLCJzdWIiOiJlOWQ0NGI0ZS03ODY0LTQxZjEtOWM4NS1kZjU2NjM2ZTlmOTMiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJ3aG9hbWkiLCJzZXNzaW9uX3N0YXRlIjoiMDAzNGZlNDktYjQwMS00NDZkLThhOGEtN2M3ZWY5ZWM1MTBhIiwiYWNyIjoiMSIsInNjb3BlIjoicHJvZmlsZSB3aG9hbWkgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJVc2VyIFplcm8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ1c2VyMCIsImdpdmVuX25hbWUiOiJVc2VyIiwiZmFtaWx5X25hbWUiOiJaZXJvIiwiZW1haWwiOiJ1c2VyMEBtYWlsLmNvbSJ9.uIwasavUe1AkLYF6AS_nvVROkV3aIZGT260vHLmNZEPfxW8BorrmLoB4BmgzgOtO2v9sCL1IvulMLiTaWAaZQSr5MmU893koiCll3Q6wfeHkjHI2prBFq1SLpSLuQxog7eZV-80TOzDeQkGp-tC9mS_gN2QAbpCF9nTTl32b30gojLhFW9M21lMheVvnw8jrk2YrX1cCWAiAkAqDv5xPlhGKLhNF8ZqHY5XkNKxEtlEtBLu93K0VfdM-muDz6R1HzzPCOVlYSYmkcGIExM8h4uo859SB8_lHb3w5A-ugNAm6NfOfYC1hU2yDJKQJFVzQ0MXhayZ1YYpNmiWAeKdZqA"}}
		 with token_constraints as {
			"cert": "{\"keys\":[{\"kid\":\"bgVSzJgHh1dnVagZNN74w7Xt-_glmdV8MEeHp8eKIgI\",\"kty\":\"RSA\",\"alg\":\"RS256\",\"use\":\"sig\",\"n\":\"7V1dWdxq_dYItuS3ee-n2QQdqiMTplUBVBs-GgU8GRGk-nxAbAH82y6GVHgoh8VSMG2gjQpvztpjdds5gv2cMENyQ8r73aMXTb40YhyrQT4-LX08pK6w3DKtJDa4SCiDzsnglg93wZ5fzUyI8XYfb_eWK19Nmz_26azDCbstkZ_KK5eerVCGho3AnYEaBlJj9GE8btKaCkMOGBEBLRWMm5znYJjdtm1GBklvDzZFeaYMON-qmpImLvbZbYiOCGObfEty1cZm61oIeBXU-fWgQ06dVfEs-CVDSil4KZKGqxct5rvpxsYmcg5KVcEQrpJQ7rJRB33K1cM_eUaJtUY3lQ\",\"e\":\"AQAB\",\"x5c\":[\"MIICpzCCAY8CBgFygqy1pjANBgkqhkiG9w0BAQsFADAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwHhcNMjAwNjA1MDQwOTE2WhcNMzAwNjA1MDQxMDU2WjAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDtXV1Z3Gr91gi25Ld576fZBB2qIxOmVQFUGz4aBTwZEaT6fEBsAfzbLoZUeCiHxVIwbaCNCm/O2mN12zmC/ZwwQ3JDyvvdoxdNvjRiHKtBPj4tfTykrrDcMq0kNrhIKIPOyeCWD3fBnl/NTIjxdh9v95YrX02bP/bprMMJuy2Rn8orl56tUIaGjcCdgRoGUmP0YTxu0poKQw4YEQEtFYybnOdgmN22bUYGSW8PNkV5pgw436qakiYu9tltiI4IY5t8S3LVxmbrWgh4FdT59aBDTp1V8Sz4JUNKKXgpkoarFy3mu+nGxiZyDkpVwRCuklDuslEHfcrVwz95Rom1RjeVAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAF3C8WE7X2EJ8yGZQ2INkrsuzXcnfiJ5fMdFXMu+5+2KI0b5SrnbpCr0MLcOQZqVJYRgkYOMZNCELtfwBpeZHX4id0DqyZ6KekCMpKB0ScTtpsABvcjRTj6qwT36KVhUPLiHHQ81kW4R/zz4cb4w+T+cFyya2Nxuftf6XPoeP2z4AO0zdOTaGRsT5+e/p5kZb48iKdhFJETJdTo+YAmmttQLjEB4BuxJU9aPgq0sz0C7iA/O5uNZmJyLRZCcfalzdPLye7NddWZhjHoZOzd+Lt6HOmIhMdn4dKESpjM2Fkr6LEEhJW06WsolOP/4KsEGUEQZYHsV2k+V7hXXqD9BJlA=\"],\"x5t\":\"F3JK4iyZqPxx3etycjuP-OTRLMg\",\"x5t#S256\":\"_tmQ0nQ0e_fWD-tJOMhu7YxObRDjTfiKgiIR-nXh8fw\"}]}",
			"iss": "http://keycloak.localhost/auth/realms/applications",
			"time": 0,
			"aud": "whoami",
		}
}

test_parse_without_bearer {
	not token_type_is_bearer with input as {"headers": {"authorization": "eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJiZ1ZTekpnSGgxZG5WYWdaTk43NHc3WHQtX2dsbWRWOE1FZUhwOGVLSWdJIn0.eyJleHAiOjE1OTEzMzQxNjAsImlhdCI6MTU5MTMzMzg2MCwianRpIjoiZWNmOTA2NzMtZWE0Zi00NGYzLWIwMGYtZmJhNzQzZDJmMzlmIiwiaXNzIjoiaHR0cDovL2tleWNsb2FrLmxvY2FsaG9zdC9hdXRoL3JlYWxtcy9hcHBsaWNhdGlvbnMiLCJhdWQiOiJ3aG9hbWkiLCJzdWIiOiJlOWQ0NGI0ZS03ODY0LTQxZjEtOWM4NS1kZjU2NjM2ZTlmOTMiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJ3aG9hbWkiLCJzZXNzaW9uX3N0YXRlIjoiMDAzNGZlNDktYjQwMS00NDZkLThhOGEtN2M3ZWY5ZWM1MTBhIiwiYWNyIjoiMSIsInNjb3BlIjoicHJvZmlsZSB3aG9hbWkgZW1haWwiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJVc2VyIFplcm8iLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJ1c2VyMCIsImdpdmVuX25hbWUiOiJVc2VyIiwiZmFtaWx5X25hbWUiOiJaZXJvIiwiZW1haWwiOiJ1c2VyMEBtYWlsLmNvbSJ9.uIwasavUe1AkLYF6AS_nvVROkV3aIZGT260vHLmNZEPfxW8BorrmLoB4BmgzgOtO2v9sCL1IvulMLiTaWAaZQSr5MmU893koiCll3Q6wfeHkjHI2prBFq1SLpSLuQxog7eZV-80TOzDeQkGp-tC9mS_gN2QAbpCF9nTTl32b30gojLhFW9M21lMheVvnw8jrk2YrX1cCWAiAkAqDv5xPlhGKLhNF8ZqHY5XkNKxEtlEtBLu93K0VfdM-muDz6R1HzzPCOVlYSYmkcGIExM8h4uo859SB8_lHb3w5A-ugNAm6NfOfYC1hU2yDJKQJFVzQ0MXhayZ1YYpNmiWAeKdZqA"}}
		 with token_constraints as {
			"cert": "{\"keys\":[{\"kid\":\"bgVSzJgHh1dnVagZNN74w7Xt-_glmdV8MEeHp8eKIgI\",\"kty\":\"RSA\",\"alg\":\"RS256\",\"use\":\"sig\",\"n\":\"7V1dWdxq_dYItuS3ee-n2QQdqiMTplUBVBs-GgU8GRGk-nxAbAH82y6GVHgoh8VSMG2gjQpvztpjdds5gv2cMENyQ8r73aMXTb40YhyrQT4-LX08pK6w3DKtJDa4SCiDzsnglg93wZ5fzUyI8XYfb_eWK19Nmz_26azDCbstkZ_KK5eerVCGho3AnYEaBlJj9GE8btKaCkMOGBEBLRWMm5znYJjdtm1GBklvDzZFeaYMON-qmpImLvbZbYiOCGObfEty1cZm61oIeBXU-fWgQ06dVfEs-CVDSil4KZKGqxct5rvpxsYmcg5KVcEQrpJQ7rJRB33K1cM_eUaJtUY3lQ\",\"e\":\"AQAB\",\"x5c\":[\"MIICpzCCAY8CBgFygqy1pjANBgkqhkiG9w0BAQsFADAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwHhcNMjAwNjA1MDQwOTE2WhcNMzAwNjA1MDQxMDU2WjAXMRUwEwYDVQQDDAxhcHBsaWNhdGlvbnMwggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQDtXV1Z3Gr91gi25Ld576fZBB2qIxOmVQFUGz4aBTwZEaT6fEBsAfzbLoZUeCiHxVIwbaCNCm/O2mN12zmC/ZwwQ3JDyvvdoxdNvjRiHKtBPj4tfTykrrDcMq0kNrhIKIPOyeCWD3fBnl/NTIjxdh9v95YrX02bP/bprMMJuy2Rn8orl56tUIaGjcCdgRoGUmP0YTxu0poKQw4YEQEtFYybnOdgmN22bUYGSW8PNkV5pgw436qakiYu9tltiI4IY5t8S3LVxmbrWgh4FdT59aBDTp1V8Sz4JUNKKXgpkoarFy3mu+nGxiZyDkpVwRCuklDuslEHfcrVwz95Rom1RjeVAgMBAAEwDQYJKoZIhvcNAQELBQADggEBAF3C8WE7X2EJ8yGZQ2INkrsuzXcnfiJ5fMdFXMu+5+2KI0b5SrnbpCr0MLcOQZqVJYRgkYOMZNCELtfwBpeZHX4id0DqyZ6KekCMpKB0ScTtpsABvcjRTj6qwT36KVhUPLiHHQ81kW4R/zz4cb4w+T+cFyya2Nxuftf6XPoeP2z4AO0zdOTaGRsT5+e/p5kZb48iKdhFJETJdTo+YAmmttQLjEB4BuxJU9aPgq0sz0C7iA/O5uNZmJyLRZCcfalzdPLye7NddWZhjHoZOzd+Lt6HOmIhMdn4dKESpjM2Fkr6LEEhJW06WsolOP/4KsEGUEQZYHsV2k+V7hXXqD9BJlA=\"],\"x5t\":\"F3JK4iyZqPxx3etycjuP-OTRLMg\",\"x5t#S256\":\"_tmQ0nQ0e_fWD-tJOMhu7YxObRDjTfiKgiIR-nXh8fw\"}]}",
			"iss": "http://keycloak.localhost/auth/realms/applications",
			"time": 0,
			"aud": "whoami",
		}
}
